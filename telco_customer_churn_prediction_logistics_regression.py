# -*- coding: utf-8 -*-
"""Telco-Customer-Churn-Prediction_Logistics Regression.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1WZzSKYN14YRbs_hiH1mBRIdZW78cCZ-6

Telco-Customer-Churn-Prediction_Logistics Regression_Machine learning model
"""

from google.colab import files

uploader = files.upload()

import pandas as pd

df  = pd.read_csv("Telco-Customer-Churn.csv")

df.head()

## checking column Dtype
df.info()

## checking for any null value
df.isnull().sum()

## checking for any blank value present in datset
df = df.replace(r'^\s*$'"", pd.NA, regex=True)
df.isna().sum()

## filling my blank column in Total charges by mean
df['TotalCharges'] = pd.to_numeric(df['TotalCharges'], errors='coerce')
df['TotalCharges'] = df['TotalCharges'].fillna(df['TotalCharges'].mean())
df['TotalCharges'].isna().sum()

## checking for duplicate data present in dataset

df['customerID'].duplicated().sum()

## checking percentage % of churn present in dataset
import matplotlib.pyplot as plt

df['Churn'].value_counts().plot(kind='bar')
plt.title("Churn proportion")
plt.xlabel("Churn Y / N")
plt.ylabel("Count")
plt.show()

churn_pro = (df['Churn'].value_counts(normalize=True)*100).round(2)
print(churn_pro.astype(str) + "%")

## remove unwanted column from datset and

df = df.drop(['customerID'], axis=1)
df['Churn'] = df['Churn'].map({'Yes': 1, 'No': 0})
df

## Apply feature engineering (Process of transforming raw data into useful features Input that help us to understand model in term of numerical data )

from sklearn.preprocessing import LabelEncoder

Le = LabelEncoder()

for col in df.select_dtypes(include=['object']).columns:
    df[col] = Le.fit_transform(df[col])

## Applying train_test_split method to device

x = df.drop(['Churn'], axis=1)
y = df['Churn']

from sklearn.model_selection import train_test_split
x_train, x_test, y_train, y_test = train_test_split(x, y, test_size=0.3, random_state=42)

## Implement  Logistics Regression machine learning model

from sklearn.linear_model import LogisticRegression

model = LogisticRegression(max_iter=1000)
model = model.fit(x_train, y_train)

## checking model accuracy by using Accuracy_Score , Confusion matrix and  classification metrics

from sklearn.metrics import accuracy_score, confusion_matrix, classification_report

print("=====Machine Learning model TRAIN RESULTS =====")

y_pred = model.predict(x_test)
Accuracy_score = accuracy_score(y_test, y_pred)
print("Accuracy Score:\n\n", Accuracy_score * 100, "%")

confusion_matrix = confusion_matrix(y_test, y_pred)
print("Confusion Matrix: \n\n", confusion_matrix)

classification_report = classification_report(y_test, y_pred)
print("Classification Report: \n\n", classification_report)

## checking for feature column among in provided datset using RFE ( Recursive feature Elemination )
## To improve our model performance by removing unwanted or least important column from dataset (df)

from sklearn.feature_selection import RFE

#selecting top 11 feature ( Important columns ) from given dataset

selector = RFE(model , n_features_to_select=11 , step=1)
selector = selector.fit(x_train, y_train)

print("selecting top 10 features column from given dataset\n\n",x_train.columns[selector.support_])

## deploy machine learning model

import joblib

joblib.dump(model,"Telco-Customer-Churn-Prediction_model.pkl")

files.download("Telco-Customer-Churn-Prediction_model.pkl")